(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{200:function(t,n,s){"use strict";s.r(n);var e=s(0),a=Object(e.a)({},(function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[s("a",{attrs:{href:"https://kdocs.cn/l/sjn7E74n0Upm",target:"_blank",rel:"noopener noreferrer"}},[t._v("性能优化脑图"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("在进行优化网站之前，首先知道性能优化指标是什么，才可衡量优化之后网站性能在哪些方面得到了提升")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("如图所示，performance包括了六个属性，其中 timing 是我们需要重点关注的，timing 是一个 map 数据结构，其中 key 值是性能优化指标，value 值是对应的时间戳。这些时间戳与页面整个加载过程中的关键节点是有着一一对应的关系，通过谷歌开发者网站的一张图来说明：")]),t._v(" "),t._m(4),t._v(" "),s("p",[t._v("从图中可以看到很多指标都是成对出现，这里我们直接作差就可以求出对应页面加载过程中关键节点的时间，这里我们介绍几个比较常用的，比如：")]),t._v(" "),t._m(5),t._m(6),t._v(" "),s("p",[t._v("这些指标也可以在 Chrome 浏览器的 network 面板中的 Timing 下查看，如图：")]),t._v(" "),t._m(7),t._v(" "),s("p",[t._v("以上的瀑布图就是这些指标更为直观的展示。")]),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("根据 Google 在 web.dev 上公布的数据，认为以用户为中心的性能指标，应该能回答以下四个问题")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),s("p",[t._v("首字节到达的时间点。")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),s("p",[t._v("First Meaningful Paint, 首次有意义的绘制，这个指标反映的是主要内容出现在页面上所需要的时间，如果FMP时间过长的话，这里就要考虑是不是静态文件阻塞了主线程。")]),t._v(" "),t._m(17),t._v(" "),s("p",[t._v("当用户确定自己的请求发生了后，就会开始关心第二个问题：“是否有用？”例如，用户在使用天气应用，在确定页面有反应了后，就开始关心，什么时候能展现有用的内容，从而得知今天的天气。")]),t._v(" "),t._m(18),t._v(" "),s("p",[t._v("Largest Contentful Paint, 最大内容绘制时间，计算从页面开始加载到用户与页面发生交互（点击，滚动）这段时间内，最大元素绘制的时间，该时间会随着页面渲染变化而变化，因为页面中的最大元素在渲染过程中可能会发生改变。")]),t._v(" "),t._m(19),t._v(" "),s("p",[t._v("Speed Index, 速度指标，填充页面内容的速度，取开始加载到最后完成渲染，每一时刻页面未完成度的积分。")]),t._v(" "),t._m(20),t._v(" "),s("p",[t._v("在用户得到了有用的信息后，用户就会基于得到的信息作出反应，这就是页面“是否可用？”例如看到了新闻后，想要评论。TTI、FID、TBT 就是回答这些问题的指标")]),t._v(" "),t._m(21),t._v(" "),s("p",[t._v("Time to Interactive, 可交互时间，等到服务器通过 HTTP 协议将响应全部返回之后，便开始 DOM Tree 的构建，完成之后，网页变成可交互状态，到此为止便是网页的可交互时间。用户可以进行正常的事件输入交互操作，这个指标是最重要的用户体验指标，用户最关心的就是什么时候可以进行交互，所以通常这个指标是我们优化的重点。")]),t._v(" "),t._m(22),t._v(" "),s("p",[t._v("Total Blocking Time, 总共阻塞时间，计算的是从 FCP 到 TTI 之间，主线程阻塞的总时间。阻塞时间是指单次任务占用主线程超过 50 ms 的部分。")]),t._v(" "),t._m(23),t._v(" "),s("p",[t._v("首次输入延迟，指用户首次输入到页面响应的时间。我们都知道第一印象的重要性，网站亦是如此。首次输入延迟会成为用户对网站很重要的第一印象，决定用户有可能成为忠实用户或者弃之而去。值得注意的是，FID 仅关注用户离散的操作，如点击，轻击，按键等，其他交互如滚动和缩放，并不是 FID 关注的，因为通常浏览器会用一个单独的线程来处理它们。")]),t._v(" "),t._m(24),t._v(" "),s("p",[t._v("使用是否流畅，有没有发生预料外的视觉偏移。")]),t._v(" "),t._m(25),t._v(" "),s("p",[t._v("Cumulative Layout Shift, 累计布局偏移。测量在页面的整个生命周期中发生的每个意外的样式移动所造成的布局偏移分数的总和。")]),t._v(" "),s("p",[t._v("测试视觉稳定性上的体验，有多少内容发生了意外的偏移")]),t._v(" "),s("p",[t._v("下面是一些指标的所示，如图：")]),t._v(" "),t._m(26),t._v(" "),s("p",[t._v("上面介绍的4个指标，其中 "),s("code",[t._v("First Paint")]),t._v(" 和 "),s("code",[t._v("First Contentful Paint")]),t._v(" 是有对应的 API 来直接进行获取的，我们可以在控制台输入 "),s("code",[t._v("window.performance.getEntriesByType('paint')")]),t._v(" 获取，另外2个指标我们可以通过性能优化工具 "),s("a",{attrs:{href:"https://developers.google.com/web/tools/lighthouse?hl=zh-cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lighthouse"),s("OutboundLink")],1),t._v(" 实时测量进行获取")]),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),s("p",[t._v("谷歌推出的 "),s("a",{attrs:{href:"https://web.dev/rail/",target:"_blank",rel:"noopener noreferrer"}},[t._v("RAIL"),s("OutboundLink")],1),t._v(" 模型也比较常用")]),t._v(" "),t._m(29)])}),[function(){var t=this.$createElement,n=this._self._c||t;return n("h1",{attrs:{id:"性能优化指标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#性能优化指标"}},[this._v("#")]),this._v(" 性能优化指标")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"performance-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#performance-api"}},[this._v("#")]),this._v(" Performance API")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[this._v("Performance 接口可以获取到当前页面中与性能相关的信息。在控制台 "),n("code",[this._v("console")]),this._v(" 输入 "),n("code",[this._v("window.performance")]),this._v(" 回车，打印出以下信息。")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:"/images/performance/performance-api.png",alt:"Performance API"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:"/images/performance/api.jpg",alt:"Performance API"}})])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" timingInfo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("performance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DNS 解析耗时:")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domainLookupEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domainLookupStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TCP 连接耗时")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connectEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connectStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SSL 安全连接耗时")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connectEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("secureConnectionStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 网络请求耗时 (TTFB)")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requestStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据传输耗时")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DOM 解析耗时")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domInteractive "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseEnd\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 资源加载耗时")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loadEventStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domContentLoadedEventEnd\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// First Byte时间")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domainLookupStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 白屏时间")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 首次可交互时间")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domInteractive "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DOM Ready 时间")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domContentLoadEventEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 页面完全加载时间")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loadEventStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchStart\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// http 头部大小")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transferSize "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encodedBodySize\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 重定向次数")]),t._v("\nperformance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navigation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redirectCount\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 重定向耗时: ")]),t._v("\ntimingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redirectEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" timingInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redirectStart\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("使用场景")]),this._v("： 使用以上这些指标 "),n("code",[this._v("API")]),this._v("，在目标页面注入脚本，在约定的时机收集性能指标数据，统一上报数据中心，数据中心集中整合生成报表，再根据报表分析性能。")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:"/images/performance/performance%E5%8F%AF%E8%A7%86%E5%8C%96.png",alt:"Performance API"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"感官性能优化指标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#感官性能优化指标"}},[this._v("#")]),this._v(" 感官性能优化指标")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ul",[s("li",[s("strong",[t._v("是否发生？")]),t._v(" 导航是否成功启动？服务器是否有响应？")]),t._v(" "),s("li",[s("strong",[t._v("是否有用？")]),t._v(" 是否已渲染可以与用户互动的足够内容？")]),t._v(" "),s("li",[s("strong",[t._v("是否可用？")]),t._v(" 用户可以与页面交互，还是页面仍在忙于加载？")]),t._v(" "),s("li",[s("strong",[t._v("是否令人愉快?")]),t._v(" 交互是否顺畅而自然，没有滞后和卡顿")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"是否发生"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#是否发生"}},[this._v("#")]),this._v(" 是否发生")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("TTFB (Time to First Byte)")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("FP (First Paint)")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[this._v("首次绘制，表示文档中任一元素 "),n("strong",[this._v("首次渲染时间")]),this._v("。")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("FCP")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[this._v("First Contentful Paint, 首次内容绘制，标记浏览器渲染来自 DOM 第一位内容的时间点，内容可能是文本、图像等元素。测试加载速度的体验，页面最主要的内容何时呈现。这个指标就是我们日常说的 "),n("strong",[this._v("白屏时间")]),this._v("。")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("FMP")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"是否有用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#是否有用"}},[this._v("#")]),this._v(" 是否有用")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("LCP")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("SI")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"是否可用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#是否可用"}},[this._v("#")]),this._v(" 是否可用")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("TTI")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("TBT")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("FID (First Input Delay)")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"是否令人愉快"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#是否令人愉快"}},[this._v("#")]),this._v(" 是否令人愉快")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("strong",[this._v("CLS")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:"/images/performance/first-page.jpg",alt:"Performance API"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:"/images/performance/light-performance.png",alt:"淘宝案例分析"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"google-rail-模型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#google-rail-模型"}},[this._v("#")]),this._v(" Google RAIL 模型")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("R(Response 响应): 处理事件应在 100ms 以内完成")]),this._v(" "),n("li",[this._v("A(Animation 动画)：每帧16ms, 计算公式：16 ms/ fps = 每10ms 产生一帧 + 浏览器绘制 6ms")]),this._v(" "),n("li",[this._v("I(Idle空闲)：主线程 JS 工作分成不大于 50 毫秒的块,尽可能增加空闲时间")]),this._v(" "),n("li",[this._v("L(Load加载)：页面可以在 1000 毫秒内就绪, 在 5 s 内完成内容加载并可以交互")])])}],!1,null,null,null);n.default=a.exports}}]);