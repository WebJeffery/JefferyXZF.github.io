<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 构建优化 | Jeffery Blog</title>
    <meta name="description" content="记录和分享技术">
    <link rel="icon" href="/images/photo.jpg">
  <link rel="manifest" href="/images/photo.jpg">
  <link rel="apple-touch-icon" href="/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.83e51879.css" as="style"><link rel="preload" href="/assets/js/app.f96d0dc8.js" as="script"><link rel="preload" href="/assets/js/19.d4d9a945.js" as="script"><link rel="prefetch" href="/assets/js/10.8506b9fc.js"><link rel="prefetch" href="/assets/js/11.2ac88bab.js"><link rel="prefetch" href="/assets/js/12.ae3ae057.js"><link rel="prefetch" href="/assets/js/13.4a7cb9d2.js"><link rel="prefetch" href="/assets/js/14.50a65c01.js"><link rel="prefetch" href="/assets/js/15.2c09bf95.js"><link rel="prefetch" href="/assets/js/16.fe1d8458.js"><link rel="prefetch" href="/assets/js/17.76935e2c.js"><link rel="prefetch" href="/assets/js/18.a3e9694d.js"><link rel="prefetch" href="/assets/js/2.e1a2e5a6.js"><link rel="prefetch" href="/assets/js/20.c6f91d1d.js"><link rel="prefetch" href="/assets/js/21.9daaa140.js"><link rel="prefetch" href="/assets/js/22.706a5717.js"><link rel="prefetch" href="/assets/js/23.b55e5f59.js"><link rel="prefetch" href="/assets/js/24.e57fd181.js"><link rel="prefetch" href="/assets/js/25.de753c09.js"><link rel="prefetch" href="/assets/js/26.75e03a0a.js"><link rel="prefetch" href="/assets/js/27.0f39ac24.js"><link rel="prefetch" href="/assets/js/28.b4f1e26a.js"><link rel="prefetch" href="/assets/js/29.7e147ce9.js"><link rel="prefetch" href="/assets/js/3.fca730b7.js"><link rel="prefetch" href="/assets/js/30.08287792.js"><link rel="prefetch" href="/assets/js/31.4a26cbda.js"><link rel="prefetch" href="/assets/js/32.5b443424.js"><link rel="prefetch" href="/assets/js/33.4fd4b08b.js"><link rel="prefetch" href="/assets/js/34.a31c0f36.js"><link rel="prefetch" href="/assets/js/35.88cafe94.js"><link rel="prefetch" href="/assets/js/36.7812381a.js"><link rel="prefetch" href="/assets/js/37.5f9f2adb.js"><link rel="prefetch" href="/assets/js/38.118ba1f4.js"><link rel="prefetch" href="/assets/js/39.b67f7277.js"><link rel="prefetch" href="/assets/js/4.9e7532a1.js"><link rel="prefetch" href="/assets/js/40.e55debb3.js"><link rel="prefetch" href="/assets/js/41.d7903d06.js"><link rel="prefetch" href="/assets/js/42.77614d76.js"><link rel="prefetch" href="/assets/js/43.b81eee3a.js"><link rel="prefetch" href="/assets/js/44.4ade92d1.js"><link rel="prefetch" href="/assets/js/45.8bea4d57.js"><link rel="prefetch" href="/assets/js/46.3bdb04e6.js"><link rel="prefetch" href="/assets/js/47.c894c4b2.js"><link rel="prefetch" href="/assets/js/48.78e60e2b.js"><link rel="prefetch" href="/assets/js/49.9c5c8f7d.js"><link rel="prefetch" href="/assets/js/5.a3c90268.js"><link rel="prefetch" href="/assets/js/50.832279c4.js"><link rel="prefetch" href="/assets/js/51.cc16f222.js"><link rel="prefetch" href="/assets/js/52.b28aa4d0.js"><link rel="prefetch" href="/assets/js/53.ebabf090.js"><link rel="prefetch" href="/assets/js/54.28bdfc99.js"><link rel="prefetch" href="/assets/js/55.a1b4df06.js"><link rel="prefetch" href="/assets/js/56.6fb0c31d.js"><link rel="prefetch" href="/assets/js/57.b9df5c2d.js"><link rel="prefetch" href="/assets/js/58.47940a92.js"><link rel="prefetch" href="/assets/js/6.4133d95a.js"><link rel="prefetch" href="/assets/js/7.ea728375.js"><link rel="prefetch" href="/assets/js/8.b6825a68.js"><link rel="prefetch" href="/assets/js/9.4d493f14.js">
    <link rel="stylesheet" href="/assets/css/0.styles.83e51879.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jeffery Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/vue-home.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/web/javascript/home.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/web/typescript/guide.html" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/web/html/" class="nav-link">HTML</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/vscode/shortcut-key.html" class="nav-link">VS Code</a></li><li class="dropdown-item"><!----> <a href="/tools/git/basics.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/tools/gitlab/webhook.html" class="nav-link">GitLab</a></li><li class="dropdown-item"><!----> <a href="/tools/develop/doc.html" class="nav-link">工具库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端基建</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/infrastructure/performance/01-optimize-index.html" class="nav-link">性能优化</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/JefferyXZF" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/vue-home.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/web/javascript/home.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/web/typescript/guide.html" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/web/html/" class="nav-link">HTML</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/vscode/shortcut-key.html" class="nav-link">VS Code</a></li><li class="dropdown-item"><!----> <a href="/tools/git/basics.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/tools/gitlab/webhook.html" class="nav-link">GitLab</a></li><li class="dropdown-item"><!----> <a href="/tools/develop/doc.html" class="nav-link">工具库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端基建</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/infrastructure/performance/01-optimize-index.html" class="nav-link">性能优化</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/JefferyXZF" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/infrastructure/performance/01-optimize-index.html" class="sidebar-link">性能优化指标</a></li><li><a href="/infrastructure/performance/02-optimize-tool.html" class="sidebar-link">性能优化工具</a></li><li><a href="/infrastructure/performance/03-optimize-image.html" class="sidebar-link">图片资源优化</a></li><li><a href="/infrastructure/performance/04-render-optimize.html" class="sidebar-link">渲染优化</a></li><li><a href="/infrastructure/performance/05-webpack-optimize.html" aria-current="page" class="active sidebar-link">webpack构建优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/infrastructure/performance/05-webpack-optimize.html#构建速度优化" class="sidebar-link">构建速度优化</a></li><li class="sidebar-sub-header"><a href="/infrastructure/performance/05-webpack-optimize.html#打包体积优化" class="sidebar-link">打包体积优化</a></li><li class="sidebar-sub-header"><a href="/infrastructure/performance/05-webpack-optimize.html#其他" class="sidebar-link">其他</a></li></ul></li><li><a href="/infrastructure/performance/06-network-optimize.html" class="sidebar-link">网络传输优化</a></li><li><a href="/infrastructure/performance/07-cache-optimize.html" class="sidebar-link">缓存优化</a></li><li><a href="/infrastructure/performance/08-code-optimize.html" class="sidebar-link">代码优化</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="webpack-构建优化"><a href="#webpack-构建优化" class="header-anchor">#</a> webpack 构建优化</h1> <p>这里的构建优化主要是针对 webpack 构建工具的优化，webpack 优化主要分为：构建速度优化和打包体积优化</p> <h2 id="构建速度优化"><a href="#构建速度优化" class="header-anchor">#</a> 构建速度优化</h2> <h3 id="缩小文件查找范围"><a href="#缩小文件查找范围" class="header-anchor">#</a> 缩小文件查找范围</h3> <p>webpack 查找文件会根据依赖和配置进行查找，缩小查找文件范围会提高我们的构建速度，以下列出几种做法：</p> <ul><li>loader 匹配：使用 test，include，exclude（exclude优先级比include优先级高，建议优先使用 include）</li> <li>优化 resolve.modules 配置，它默认是从 <code>node_modules</code> 中查找</li> <li>优化 resolve.mainFields 配置</li> <li>使用 resolve.alias 重命名</li> <li>resolve.extensions 优先查找</li> <li>优化 module.noParse 配置</li></ul> <h3 id="使用-webpack-dllplugin-来预先编译"><a href="#使用-webpack-dllplugin-来预先编译" class="header-anchor">#</a> 使用 webpack.DllPlugin 来预先编译</h3> <p>预先编译和打包不会变动存在的文件，在业务代码中直接引入，加快 Webpack 编译打包的速度，但是并不能减少最后生成的代码体积。</p> <h3 id="多线程和多进程打包"><a href="#多线程和多进程打包" class="header-anchor">#</a> 多线程和多进程打包</h3> <p>有两种方案：thread-loader 和 HappyPack</p> <ul><li><p>thread-loader 是针对 loader 进行优化的，它会将 loader 放置在一个 worker 池里面运行，以达到多线程构建。
thread-loader 在使用的时候，需要将其放置在其他 loader 之前</p></li> <li><p>HappyPack 是通过多进程模型，来加速代码构建</p></li></ul> <h3 id="使用自动刷新"><a href="#使用自动刷新" class="header-anchor">#</a> 使用自动刷新</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token comment">// 只有在开启监听模式时，watchOptions 才有意义  </span>
  <span class="token comment">// 默认为 false，也就是不开启  </span>
  watch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
  <span class="token comment">// 监听模式运行时的参数 </span>
  <span class="token comment">// 在开启监听模式时，才有意义  </span>
  watchOptions<span class="token operator">:</span> <span class="token punctuation">{</span>    
  <span class="token comment">// 不监听的文件或文件夹，支持正则匹配   </span>
  <span class="token comment">// 默认为空   </span>
  ignored<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> 
  <span class="token comment">//监听到变化发生后会等300ms再去执行动作，防止文件更新太快导致重新编译频率太高, 默认为 300ms    </span>
  aggregateTimeout<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>    
  <span class="token comment">// 判断文件是否发生变化是通过不停的去询问系统指定文件有没有变化实现的    </span>
  <span class="token comment">// 默认每隔1000毫秒询问一次    </span>
  poll<span class="token operator">:</span> <span class="token number">1000</span> 
 <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="压缩速度优化"><a href="#压缩速度优化" class="header-anchor">#</a> 压缩速度优化</h3> <p>使用terser-webpack-plugin 的时候可以通过下面的配置开启多线程和缓存：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
  minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
     <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启缓存</span>
      parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 多线程</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="其他构建速度优化"><a href="#其他构建速度优化" class="header-anchor">#</a> 其他构建速度优化</h3> <ul><li><p>sourceMap 生成耗时严重，根据之前 sourceMap[TODO](sourcemap 表格链接)表格选择合适的 devtool 值；</p></li> <li><p>切换一些 loader 或者插件，比如：fast-sass-loader 可以并行处理 sass 文件，要比 sass-loader 快 5~10倍；</p></li> <li><p>babel-loader 的 cacheDirectory</p></li></ul> <h2 id="打包体积优化"><a href="#打包体积优化" class="header-anchor">#</a> 打包体积优化</h2> <h3 id="javascript-压缩"><a href="#javascript-压缩" class="header-anchor">#</a> JavaScript 压缩</h3> <p><code>terser-webpack-plugin</code> 这个插件很强大，除了开启多线程打包，还可以打包压缩，去除注释等无用打包，具体使用如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token comment">// 使用 cache，加快二次构建速度</span>
 cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
 terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
   comments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
   compress<span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token comment">// 删除无用的代码</span>
  unused<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
 <span class="token comment">// 删掉 debugger</span>
 drop_debugger<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// eslint-disable-line</span>
 <span class="token comment">// 移除 console</span>
 drop_console<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// eslint-disable-line</span>
 <span class="token comment">// 移除无用的代码</span>
 dead_code<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// eslint-disable-line</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="css-优化"><a href="#css-优化" class="header-anchor">#</a> CSS 优化</h3> <ul><li><p>使用 <code>mini-css-extract-plugin</code> webpack 插件，从 js 文件中分离 CSS 到单独到文件，方便使用缓存</p></li> <li><p>压缩 CSS：cssnano，css-loader 已经集成了 cssnano，还可以使用  <code>optimize-css-assets-webpack-plugin</code> 来自定义 cssnano 的规则, 比如：删除空格和最后一个分号；删除注释；优化字体权重；丢弃重复的样式规则；压缩选择器；减少手写属性；合并规则；</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> OptimizeCssAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> 
 plugins<span class="token operator">:</span> <span class="token punctuation">[</span> 
   <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
      assetNameRegExp<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.optimize\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> 
       cssProcessor<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 这里制定了引擎，不指定默认也是 cssnano </span>
        cssProcessorPluginOptions<span class="token operator">:</span> <span class="token punctuation">{</span> 
          preset<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> discardComments<span class="token operator">:</span> <span class="token punctuation">{</span>removeAll<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> 
          <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        canPrint<span class="token operator">:</span> <span class="token boolean">true</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="html-压缩"><a href="#html-压缩" class="header-anchor">#</a> html 压缩</h3> <p>可以使用 <code>html-webpack-plugin</code> 这个插件配置压缩 <code>html</code> 代码</p> <h3 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree-Shaking</h3> <p>按照字面翻译过来是摇树，意思是把树上没用的叶子摇落下来，具体到代码中表现为删除无用重复的代码。</p> <p>移除 JavaScript 上下文中没用的代码，这样可以有效地缩减打包体积</p> <p>使用前提和配置：</p> <ul><li>减少代码中的副作用代码；</li> <li>配置 sideEffects 告诉 webpack 模块是安全的，不会带有副作用，可以放心优化。</li> <li>要使用 Tree-Shaking 必然要保证引用的模块都是 ES6 规范的</li> <li>按需引入模块，避免「一把梭」，例如我们要使用 lodash 的 isNumber ，可以使用 <code>import isNumber from 'lodash-es/isNumber'</code>; ，而不是 <code>import {isNumber} from 'lodash-es'</code> ；</li></ul> <h3 id="scope-hoisting"><a href="#scope-hoisting" class="header-anchor">#</a> Scope Hoisting</h3> <p>作用域提升（Scope Hoisting）是指 webpack 通过 ES6 语法的静态分析，分析出模块之间的依赖关系，尽可能地把模块放到同一个函数中。</p> <p>开启了 Scope Hoisting</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
     concatenateModules<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="图片打包优化"><a href="#图片打包优化" class="header-anchor">#</a> 图片打包优化</h3> <ul><li><p>url-loader 设置 limit 转化为 Base64 减少请求，svg-url-loader 同理</p></li> <li><p>雪碧图插件合并小图，减少请求</p></li> <li><p>用 image-webpack-loader 等来打包压缩图片</p></li></ul> <h3 id="按需加载"><a href="#按需加载" class="header-anchor">#</a> 按需加载</h3> <p>使用 <code>import()</code> 和 <code>require.ensure()</code> 动态导入函数，动态导入会划分到新的 bundle 打包文件中，从而减少主体打包文件体积</p> <h3 id="配置多个入口"><a href="#配置多个入口" class="header-anchor">#</a> 配置多个入口</h3> <p>使用多个入口文件，打包到不同的bundle文件中，也可以减少打包体积</p> <h3 id="代码分割（code-splitting）"><a href="#代码分割（code-splitting）" class="header-anchor">#</a> 代码分割（Code Splitting）</h3> <p>代码分割（Code Splitting）是指将项目代码构建打包（Bundler）后，根据指定规则分割成多个 bundles（输出文件），这些模块文件可以被按需动态加载或者并行加载，可以用来优化代码加载时的资源大小及优先级。正确使用代码分割，可以优化提升资源加载效率。</p> <p><strong>代码分割方案</strong></p> <p>前面提到，使用按需加载， ES6 新增的 import() 方法，会将我们的代码分割出来，具体使用如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Test1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span>
  <span class="token comment">/* webpackChunkName: &quot;Test1&quot; */</span>
  <span class="token string">'./pages/Test1.vue'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">Test2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span>
  <span class="token comment">/* webpackChunkName: &quot;Test2&quot; */</span>
  <span class="token string">'./pages/Test2.vue'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这里 Webpack 配置的输出也要做对应的修改，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	output<span class="token operator">:</span> <span class="token punctuation">{</span>
  	chunkFilename<span class="token operator">:</span> <span class="token string">'[name].chunk.js'</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>[webpackChunkName].chunk.js</code> 就是打包的文件名了</p> <p><strong>splitChunks 实现代码分割</strong></p> <p>具体配置可以参考 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/#optimizationsplitchunks" target="_blank" rel="noopener noreferrer">webpack 网站<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <ul><li>合理划分代码职责，适当使用按需加载方案；</li> <li>善用 webpack-bundle-analyzer 插件，帮助分析 Webpack 打包后的模块依赖关系；</li> <li>设置合理的 SplitChunks 分组；</li> <li>对于一些 UI 组件库，例如 AntDesign、ElementUI 等，可以使用bable-plugin-import这类工具进行优化；</li> <li>使用 lodash、momentjs 这类库，不要一股脑引入，要按需引入，momentjs 可以用 date-fns 库来代替；</li> <li>合理使用 hash 占位符，防止 hash 重复出现，导致文件名变化从而 HTTP 缓存过期；</li> <li>合理使用 polyfill，防止多余的代码；</li> <li>使用 ES6 语法，尽量不使用具有副作用的代码，以加强 Tree-Shaking 的效果；</li> <li>使用 Webpack 的 Scope Hoisting（作用域提升）功能。</li></ul> <p>Tips：其实 webpack 4 中，在 production 模式下已经根据大多数项目的优化经验做了通用的配置，类似Tree-Shaking、Scope Hoisting 都是默认开启的，而且最新版本的 Webpack 使用的压缩工具就是 terser-webpack-plugin。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/infrastructure/performance/04-render-optimize.html" class="prev">
          渲染优化
        </a></span> <span class="next"><a href="/infrastructure/performance/06-network-optimize.html">
          网络传输优化
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.f96d0dc8.js" defer></script><script src="/assets/js/19.d4d9a945.js" defer></script>
  </body>
</html>
